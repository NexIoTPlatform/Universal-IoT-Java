<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.universal.persistence.mapper.SupportMapAreasMapper">
    <resultMap id="BaseResultMap" type="cn.universal.persistence.entity.SupportMapAreas">
        <!--
          WARNING - @mbg.generated
        -->

        <result column="id" jdbcType="BIGINT" property="id"/>
        <result column="pid" jdbcType="BIGINT" property="pid"/>
        <result column="name" jdbcType="VARCHAR" property="name"/>
        <result column="full_name" jdbcType="VARCHAR" property="fullName"/>
        <result column="deep" jdbcType="BIGINT" property="deep"/>
        <result column="location" jdbcType="VARCHAR" property="location"/>
        <result column="polygon" jdbcType="VARCHAR" property="polygon"/>
    </resultMap>

    <!-- 根据经纬度查询区域id -->
    <select id="selectMapAreas" resultType="cn.universal.persistence.entity.SupportMapAreas">
        select id
        from support_map_areas
        where st_within(st_geomfromtext('POINT('
        <if test="lon!=null and lon!=''">
            #{lon}
        </if>
        ' '
        <if test="lat!=null and lat!=''">
            #{lat}
        </if>
        ')'), polygon) order by deep desc limit 1;
    </select>

</mapper>