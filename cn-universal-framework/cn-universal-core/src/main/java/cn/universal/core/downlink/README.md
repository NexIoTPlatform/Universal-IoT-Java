# ä¸‹è¡Œæ¶ˆæ¯æ‹¦æˆªå™¨ç³»ç»Ÿ

## ğŸ“– æ¦‚è¿°

ä¸‹è¡Œæ¶ˆæ¯æ‹¦æˆªå™¨ç³»ç»Ÿæä¾›äº†ä¸€ä¸ªä¼˜é›…ã€å¯æ‰©å±•çš„æ–¹å¼ï¼Œåœ¨ä¸‹è¡Œæ¶ˆæ¯å¤„ç†æµç¨‹ä¸­æ³¨å…¥è‡ªå®šä¹‰é€»è¾‘ï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰çš„åè®®å¤„ç†ä»£ç ã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    IDown.doAction()                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          DownlinkInterceptorChainï¼ˆæ‹¦æˆªå™¨é“¾ï¼‰             â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  PRE é˜¶æ®µï¼ˆå‰ç½®æ‹¦æˆªå™¨ï¼‰                          â”‚    â”‚
â”‚  â”‚  - æ•°æ®æ ¡éªŒ ValidationInterceptor               â”‚    â”‚
â”‚  â”‚  - æ—¥å¿—è®°å½• LoggingInterceptor                  â”‚    â”‚
â”‚  â”‚  - ç›‘æ§ç»Ÿè®¡ MetricsInterceptor                  â”‚    â”‚
â”‚  â”‚  - é‰´æƒè®¤è¯ AuthenticationInterceptor           â”‚    â”‚
â”‚  â”‚  - é™æµæ§åˆ¶ RateLimitInterceptor                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            AbstractDownService.convert()                  â”‚
â”‚          ï¼ˆæ¶ˆæ¯è½¬æ¢ + ä¸Šä¸‹æ–‡æ„å»ºï¼‰                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          DownlinkInterceptorChainï¼ˆæ‹¦æˆªå™¨é“¾ï¼‰             â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  MID é˜¶æ®µï¼ˆä¸­ç½®æ‹¦æˆªå™¨ï¼‰                          â”‚    â”‚
â”‚  â”‚  - å½±å­æœåŠ¡ ShadowInterceptor                   â”‚    â”‚
â”‚  â”‚  - ç¼–è§£ç  CodecInterceptor                      â”‚    â”‚
â”‚  â”‚  - æ•°æ®å¢å¼º EnrichmentInterceptor               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        XxxDownProcessorChain.process()                    â”‚
â”‚           ï¼ˆåè®®ç‰¹å®šå¤„ç†å™¨é“¾ï¼‰                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          DownlinkInterceptorChainï¼ˆæ‹¦æˆªå™¨é“¾ï¼‰             â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  POST é˜¶æ®µï¼ˆåç½®æ‹¦æˆªå™¨ï¼‰                         â”‚    â”‚
â”‚  â”‚  - ç»“æœå¤„ç† ResultInterceptor                   â”‚    â”‚
â”‚  â”‚  - é€šçŸ¥æ¨é€ NotificationInterceptor             â”‚    â”‚
â”‚  â”‚  - å®¡è®¡æ—¥å¿— AuditInterceptor                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åˆ›å»ºè‡ªå®šä¹‰æ‹¦æˆªå™¨

```java
@Slf4j
@Component
@Order(100)  // å®šä¹‰æ‰§è¡Œé¡ºåº
public class CustomDownlinkInterceptor implements DownlinkInterceptor {

    @Override
    public String getName() {
        return "è‡ªå®šä¹‰æ‹¦æˆªå™¨";
    }

    @Override
    public int getOrder() {
        return 100;  // æ•°å­—è¶Šå°è¶Šå…ˆæ‰§è¡Œ
    }

    @Override
    public InterceptorPhase getPhase() {
        return InterceptorPhase.PRE;  // é€‰æ‹©æ‰§è¡Œé˜¶æ®µï¼šPRE, MID, POST
    }

    @Override
    public boolean supports(DownlinkContext<?> context) {
        // åˆ¤æ–­æ˜¯å¦æ”¯æŒå½“å‰ä¸Šä¸‹æ–‡
        // ä¾‹å¦‚ï¼šä»…å¤„ç†MQTTåè®®
        return "mqtt".equals(context.getProtocolCode());
    }

    @Override
    public boolean preHandle(DownlinkContext<?> context) throws Exception {
        // å‰ç½®å¤„ç†é€»è¾‘
        log.info("å¼€å§‹å¤„ç†ä¸‹è¡Œæ¶ˆæ¯: {}", context.getProtocolCode());
        
        // å¯ä»¥åœ¨ä¸Šä¸‹æ–‡ä¸­å­˜å‚¨æ•°æ®
        context.setAttribute("customKey", "customValue");
        
        // è¿”å›trueç»§ç»­æ‰§è¡Œï¼Œfalseä¸­æ–­æ‰§è¡Œ
        return true;
    }

    @Override
    public void postHandle(DownlinkContext<?> context) throws Exception {
        // åç½®å¤„ç†é€»è¾‘
        log.info("ä¸‹è¡Œæ¶ˆæ¯å¤„ç†å®Œæˆ: {}", context.getResult());
    }

    @Override
    public void afterCompletion(DownlinkContext<?> context, Exception ex) {
        // å®Œæˆå¤„ç†ï¼ˆæ— è®ºæˆåŠŸå¤±è´¥éƒ½ä¼šæ‰§è¡Œï¼‰
        if (ex != null) {
            log.error("å¤„ç†å¼‚å¸¸", ex);
        }
        // æ¸…ç†èµ„æºç­‰æ“ä½œ
    }
}
```

### 2. åœ¨åè®®å®ç°ä¸­ä½¿ç”¨

æ‹¦æˆªå™¨ä¼šè‡ªåŠ¨åº”ç”¨åˆ°æ‰€æœ‰å®ç°äº† `IDown` æ¥å£çš„åè®®æœåŠ¡ä¸­ã€‚æ— éœ€é¢å¤–é…ç½®ï¼Œåªè¦å°†æ‹¦æˆªå™¨æ³¨å†Œä¸º Spring Bean å³å¯ã€‚

## ğŸ“‹ æ‹¦æˆªå™¨æ‰§è¡Œé˜¶æ®µ

### PRE é˜¶æ®µï¼ˆå‰ç½®é˜¶æ®µï¼‰
- **æ‰§è¡Œæ—¶æœº**ï¼šåœ¨æ¶ˆæ¯è½¬æ¢ï¼ˆconvertï¼‰ä¹‹å‰
- **é€‚ç”¨åœºæ™¯**ï¼š
  - âœ… é‰´æƒè®¤è¯
  - âœ… å‚æ•°æ ¡éªŒ
  - âœ… é™æµæ§åˆ¶
  - âœ… æ—¥å¿—è®°å½•
  - âœ… ç›‘æ§ç»Ÿè®¡

### MID é˜¶æ®µï¼ˆä¸­ç½®é˜¶æ®µï¼‰
- **æ‰§è¡Œæ—¶æœº**ï¼šåœ¨æ¶ˆæ¯è½¬æ¢ï¼ˆconvertï¼‰ä¹‹åï¼Œåè®®å¤„ç†å™¨ï¼ˆprocessorï¼‰ä¹‹å‰
- **é€‚ç”¨åœºæ™¯**ï¼š
  - âœ… æ•°æ®å¢å¼º
  - âœ… ç¼–è§£ç å¤„ç†
  - âœ… å½±å­æœåŠ¡é›†æˆ
  - âœ… ä¸šåŠ¡è§„åˆ™æ ¡éªŒ

### POST é˜¶æ®µï¼ˆåç½®é˜¶æ®µï¼‰
- **æ‰§è¡Œæ—¶æœº**ï¼šåœ¨åè®®å¤„ç†å™¨ï¼ˆprocessorï¼‰æ‰§è¡Œä¹‹å
- **é€‚ç”¨åœºæ™¯**ï¼š
  - âœ… ç»“æœå¤„ç†
  - âœ… é€šçŸ¥æ¨é€
  - âœ… å®¡è®¡æ—¥å¿—
  - âœ… æ•°æ®æŒä¹…åŒ–

## ğŸ”§ ä¸Šä¸‹æ–‡å¯¹è±¡

`DownlinkContext` æä¾›äº†ä»¥ä¸‹å…³é”®ä¿¡æ¯ï¼š

```java
// åŸºæœ¬ä¿¡æ¯
context.getProtocolCode();      // åè®®ä»£ç ï¼ˆå¦‚ï¼šmqtt, tcp, httpï¼‰
context.getProtocolName();      // åè®®åç§°
context.getRawMessage();        // åŸå§‹æ¶ˆæ¯ï¼ˆå­—ç¬¦ä¸²ï¼‰
context.getJsonMessage();       // åŸå§‹æ¶ˆæ¯ï¼ˆJSONï¼‰
context.getDownRequest();       // è½¬æ¢åçš„è¯·æ±‚å¯¹è±¡

// è®¾å¤‡ä¿¡æ¯
context.getProductKey();        // äº§å“Key
context.getDeviceId();          // è®¾å¤‡ID
context.getIotId();             // IoT ID

// å¤„ç†ä¿¡æ¯
context.getResult();            // å¤„ç†ç»“æœ
context.getDuration();          // å¤„ç†è€—æ—¶ï¼ˆæ¯«ç§’ï¼‰
context.isIntercepted();        // æ˜¯å¦è¢«æ‹¦æˆª
context.getInterruptReason();   // ä¸­æ–­åŸå› 

// è‡ªå®šä¹‰å±æ€§
context.setAttribute(key, value);  // è®¾ç½®å±æ€§
context.getAttribute(key);         // è·å–å±æ€§
context.removeAttribute(key);      // ç§»é™¤å±æ€§
```

## ğŸ¯ å†…ç½®æ‹¦æˆªå™¨

### 1. DownlinkLoggingInterceptorï¼ˆæ—¥å¿—æ‹¦æˆªå™¨ï¼‰
- **Order**: 1000
- **Phase**: PRE
- **åŠŸèƒ½**: è®°å½•ä¸‹è¡Œæ¶ˆæ¯çš„è¯¦ç»†æ—¥å¿—

### 2. DownlinkMetricsInterceptorï¼ˆç›‘æ§æ‹¦æˆªå™¨ï¼‰
- **Order**: 10
- **Phase**: PRE
- **åŠŸèƒ½**: æ”¶é›†æ€§èƒ½æŒ‡æ ‡ï¼ˆè€—æ—¶ã€æˆåŠŸç‡ç­‰ï¼‰

### 3. DownlinkValidationInterceptorï¼ˆæ ¡éªŒæ‹¦æˆªå™¨ï¼‰
- **Order**: 50
- **Phase**: PRE
- **åŠŸèƒ½**: æ ¡éªŒå¿…è¦å‚æ•°

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. æ‹¦æˆªå™¨å‘½åè§„èŒƒ
```java
// å»ºè®®ä½¿ç”¨ï¼šDownlink + åŠŸèƒ½ + Interceptor
DownlinkAuthenticationInterceptor  // é‰´æƒæ‹¦æˆªå™¨
DownlinkRateLimitInterceptor       // é™æµæ‹¦æˆªå™¨
DownlinkCodecInterceptor           // ç¼–è§£ç æ‹¦æˆªå™¨
```

### 2. Order å€¼å»ºè®®
```
0-100:    ç³»ç»Ÿçº§æ‹¦æˆªå™¨ï¼ˆé‰´æƒã€é™æµã€ç›‘æ§ï¼‰
100-500:  ä¸šåŠ¡çº§æ‹¦æˆªå™¨ï¼ˆæ•°æ®å¤„ç†ã€ç¼–è§£ç ï¼‰
500-1000: è¾…åŠ©çº§æ‹¦æˆªå™¨ï¼ˆæ—¥å¿—ã€å®¡è®¡ï¼‰
```

### 3. é”™è¯¯å¤„ç†
```java
@Override
public boolean preHandle(DownlinkContext<?> context) throws Exception {
    try {
        // ä¸šåŠ¡é€»è¾‘
        return true;
    } catch (Exception e) {
        log.error("æ‹¦æˆªå™¨æ‰§è¡Œå¼‚å¸¸", e);
        // è¿”å›falseä¼šä¸­æ–­æ‰§è¡Œ
        return false;
    }
}
```

### 4. ä½¿ç”¨ä¸Šä¸‹æ–‡ä¼ é€’æ•°æ®
```java
// åœ¨å‰ç½®æ‹¦æˆªå™¨ä¸­å­˜å‚¨æ•°æ®
@Override
public boolean preHandle(DownlinkContext<?> context) {
    context.setAttribute("startTime", System.currentTimeMillis());
    return true;
}

// åœ¨åç½®æ‹¦æˆªå™¨ä¸­è·å–æ•°æ®
@Override
public void postHandle(DownlinkContext<?> context) {
    Long startTime = context.getAttribute("startTime");
    long duration = System.currentTimeMillis() - startTime;
    log.info("å¤„ç†è€—æ—¶: {}ms", duration);
}
```

### 5. æ¡ä»¶æ‰§è¡Œ
```java
@Override
public boolean supports(DownlinkContext<?> context) {
    // ä»…å¤„ç†MQTTåè®®
    if (!"mqtt".equals(context.getProtocolCode())) {
        return false;
    }
    
    // ä»…å¤„ç†ç‰¹å®šäº§å“
    String productKey = context.getProductKey();
    return "specific-product".equals(productKey);
}
```

## ğŸ”Œ æ‰©å±•ç¤ºä¾‹

### é™æµæ‹¦æˆªå™¨ç¤ºä¾‹

```java
@Slf4j
@Component
@Order(20)
public class DownlinkRateLimitInterceptor implements DownlinkInterceptor {

    @Resource
    private RedisTemplate<String, String> redisTemplate;

    @Override
    public String getName() {
        return "é™æµæ‹¦æˆªå™¨";
    }

    @Override
    public int getOrder() {
        return 20;
    }

    @Override
    public InterceptorPhase getPhase() {
        return InterceptorPhase.PRE;
    }

    @Override
    public boolean preHandle(DownlinkContext<?> context) {
        String key = "rate_limit:" + context.getProtocolCode() + ":" + context.getProductKey();
        
        // ä½¿ç”¨Rediså®ç°ç®€å•çš„è®¡æ•°é™æµ
        Long count = redisTemplate.opsForValue().increment(key);
        if (count == 1) {
            redisTemplate.expire(key, 1, TimeUnit.SECONDS);
        }
        
        // æ¯ç§’æœ€å¤š100æ¬¡
        if (count > 100) {
            log.warn("è§¦å‘é™æµ: key={}, count={}", key, count);
            return false;
        }
        
        return true;
    }

    @Override
    public void postHandle(DownlinkContext<?> context) {
        // æ— éœ€åç½®å¤„ç†
    }
}
```

### é‰´æƒæ‹¦æˆªå™¨ç¤ºä¾‹

```java
@Slf4j
@Component
@Order(30)
public class DownlinkAuthenticationInterceptor implements DownlinkInterceptor {

    @Resource
    private AuthService authService;

    @Override
    public String getName() {
        return "é‰´æƒæ‹¦æˆªå™¨";
    }

    @Override
    public int getOrder() {
        return 30;
    }

    @Override
    public InterceptorPhase getPhase() {
        return InterceptorPhase.PRE;
    }

    @Override
    public boolean preHandle(DownlinkContext<?> context) {
        String productKey = context.getProductKey();
        String deviceId = context.getDeviceId();
        
        // æ£€æŸ¥æ˜¯å¦æœ‰æƒé™ä¸‹å‘æŒ‡ä»¤
        if (!authService.hasPermission(productKey, deviceId)) {
            log.warn("é‰´æƒå¤±è´¥: productKey={}, deviceId={}", productKey, deviceId);
            return false;
        }
        
        return true;
    }

    @Override
    public void postHandle(DownlinkContext<?> context) {
        // æ— éœ€åç½®å¤„ç†
    }
}
```

## ğŸ› è°ƒè¯•å’Œæµ‹è¯•

### å¯ç”¨è°ƒè¯•æ—¥å¿—
```yaml
logging:
  level:
    cn.universal.core.downlink: DEBUG
```

### æŸ¥çœ‹æ‹¦æˆªå™¨é“¾ä¿¡æ¯
```java
@Resource
private DownlinkInterceptorChain interceptorChain;

// è·å–æ‹¦æˆªå™¨æ•°é‡
int count = interceptorChain.getInterceptorCount();

// è·å–å¯ç”¨çš„æ‹¦æˆªå™¨æ•°é‡
long enabledCount = interceptorChain.getEnabledInterceptorCount();

// è·å–æ‰€æœ‰æ‹¦æˆªå™¨åç§°
List<String> names = interceptorChain.getInterceptorNames();
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ€§èƒ½è€ƒè™‘**ï¼šæ‹¦æˆªå™¨ä¼šåœ¨æ¯æ¬¡ä¸‹è¡Œæ¶ˆæ¯æ—¶æ‰§è¡Œï¼Œé¿å…åœ¨æ‹¦æˆªå™¨ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ
2. **å¼‚å¸¸å¤„ç†**ï¼šæ‹¦æˆªå™¨ä¸­çš„å¼‚å¸¸ä¼šå¯¼è‡´æ•´ä¸ªæµç¨‹ä¸­æ–­ï¼Œéœ€è¦å¦¥å–„å¤„ç†
3. **é¡ºåºæ§åˆ¶**ï¼šé€šè¿‡ `@Order` å’Œ `getOrder()` æ§åˆ¶æ‰§è¡Œé¡ºåº
4. **é˜¶æ®µé€‰æ‹©**ï¼šæ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ‰§è¡Œé˜¶æ®µï¼ˆPRE/MID/POSTï¼‰
5. **æ¡ä»¶åˆ¤æ–­**ï¼šä½¿ç”¨ `supports()` æ–¹æ³•å®ç°æ¡ä»¶æ‰§è¡Œï¼Œé¿å…ä¸å¿…è¦çš„å¤„ç†

## ğŸ”„ è¿ç§»æŒ‡å—

å¦‚æœä½ éœ€è¦å°†ç°æœ‰çš„ä¸‹è¡Œå¤„ç†é€»è¾‘è¿ç§»åˆ°æ‹¦æˆªå™¨æ¨¡å¼ï¼š

1. **è¯†åˆ«æ¨ªåˆ‡å…³æ³¨ç‚¹**ï¼šæ—¥å¿—ã€ç›‘æ§ã€é‰´æƒç­‰é€šç”¨é€»è¾‘
2. **åˆ›å»ºå¯¹åº”æ‹¦æˆªå™¨**ï¼šå°†é€šç”¨é€»è¾‘å°è£…ä¸ºæ‹¦æˆªå™¨
3. **ç§»é™¤é‡å¤ä»£ç **ï¼šä»å„åè®®å®ç°ä¸­ç§»é™¤å·²å°è£…çš„é€»è¾‘
4. **æµ‹è¯•éªŒè¯**ï¼šç¡®ä¿æ‹¦æˆªå™¨æ­£å¸¸å·¥ä½œ

## ğŸ“š æ›´å¤šèµ„æº

- [IDown æ¥å£æ–‡æ¡£](./IDown.java)
- [DownlinkContext ä¸Šä¸‹æ–‡æ–‡æ¡£](./DownlinkContext.java)
- [DownlinkInterceptor æ‹¦æˆªå™¨æ¥å£](./DownlinkInterceptor.java)
- [DownlinkInterceptorChain æ‹¦æˆªå™¨é“¾](./DownlinkInterceptorChain.java)
