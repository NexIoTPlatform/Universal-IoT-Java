# æ•°æ®æ¡¥æ¥å­—å…¸é…ç½®è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜äº†æ•°æ®æ¡¥æ¥æ¨¡å—çš„å®Œæ•´å­—å…¸é…ç½®ï¼ŒåŒ…æ‹¬å„ç§èµ„æºç±»å‹çš„é…ç½®å­—æ®µå®šä¹‰å’Œç›¸å…³çš„å­—å…¸ç±»å‹ã€‚

## ğŸ—ï¸ å­—å…¸ç»“æ„è®¾è®¡

### 1. **å­—å…¸ç±»å‹ (sys_dict_type)**

| å­—å…¸ç±»å‹                             | è¯´æ˜       | ç”¨é€”               |
|----------------------------------|----------|------------------|
| `databridge_resource_type`       | æ•°æ®æ¡¥æ¥èµ„æºç±»å‹ | å®šä¹‰æ”¯æŒçš„èµ„æºç±»å‹        |
| `databridge_direction`           | æ•°æ®æµå‘     | å®šä¹‰æ•°æ®æµå‘ï¼ˆè¾“å…¥/è¾“å‡º/åŒå‘ï¼‰ |
| `databridge_status`              | æ¡¥æ¥çŠ¶æ€     | å®šä¹‰æ¡¥æ¥é…ç½®çš„çŠ¶æ€        |
| `databridge_type`                | æ¡¥æ¥ç±»å‹     | å®šä¹‰æ¡¥æ¥çš„æ‰§è¡Œç±»å‹        |
| `databridge_message_type`        | æ¶ˆæ¯ç±»å‹     | å®šä¹‰IoTæ¶ˆæ¯ç±»å‹        |
| `databridge_cloud_platform`      | äº‘å¹³å°ç±»å‹    | å®šä¹‰æ”¯æŒçš„äº‘å¹³å°         |
| `databridge_resource_capability` | èµ„æºèƒ½åŠ›     | å®šä¹‰èµ„æºæ”¯æŒçš„æ•°æ®æµå‘      |

### 2. **èµ„æºé…ç½®å­—æ®µç±»å‹**

æ¯ç§èµ„æºç±»å‹éƒ½æœ‰å¯¹åº”çš„é…ç½®å­—æ®µå®šä¹‰ï¼š

| èµ„æºç±»å‹          | å­—å…¸ç±»å‹                              | è¯´æ˜                    |
|---------------|-----------------------------------|-----------------------|
| MySQL         | `databridge_mysql_fields`         | MySQLæ•°æ®åº“é…ç½®å­—æ®µ          |
| Kafka         | `databridge_kafka_fields`         | Kafkaæ¶ˆæ¯é˜Ÿåˆ—é…ç½®å­—æ®µ         |
| MQTT          | `databridge_mqtt_fields`          | MQTTæ¶ˆæ¯ä»£ç†é…ç½®å­—æ®µ          |
| HTTP          | `databridge_http_fields`          | HTTPæ¥å£é…ç½®å­—æ®µ            |
| Redis         | `databridge_redis_fields`         | Redisç¼“å­˜é…ç½®å­—æ®µ           |
| IoTDB         | `databridge_iotdb_fields`         | IoTDBæ—¶åºæ•°æ®åº“é…ç½®å­—æ®µ        |
| InfluxDB      | `databridge_influxdb_fields`      | InfluxDBæ—¶åºæ•°æ®åº“é…ç½®å­—æ®µ     |
| Elasticsearch | `databridge_elasticsearch_fields` | Elasticsearchæœç´¢å¼•æ“é…ç½®å­—æ®µ |
| é˜¿é‡Œäº‘IoT        | `databridge_aliyun_fields`        | é˜¿é‡Œäº‘IoTå¹³å°é…ç½®å­—æ®µ          |
| è…¾è®¯äº‘IoT        | `databridge_tencent_fields`       | è…¾è®¯äº‘IoTå¹³å°é…ç½®å­—æ®µ          |
| åä¸ºäº‘IoT        | `databridge_huawei_fields`        | åä¸ºäº‘IoTå¹³å°é…ç½®å­—æ®µ          |

## ğŸ”§ é…ç½®å­—æ®µæ ¼å¼

æ¯ä¸ªé…ç½®å­—æ®µçš„ `remark` å­—æ®µåŒ…å«JSONæ ¼å¼çš„å­—æ®µå®šä¹‰ï¼š

```json
{
  "type": "å­—æ®µç±»å‹",
  "required": "æ˜¯å¦å¿…å¡«",
  "placeholder": "å ä½ç¬¦æ–‡æœ¬",
  "default": "é»˜è®¤å€¼",
  "options": ["é€‰é¡¹1", "é€‰é¡¹2"],
  "min": "æœ€å°å€¼",
  "max": "æœ€å¤§å€¼"
}
```

### å­—æ®µç±»å‹è¯´æ˜

| ç±»å‹         | è¯´æ˜    | ç¤ºä¾‹            |
|------------|-------|---------------|
| `input`    | æ–‡æœ¬è¾“å…¥æ¡† | ä¸»æœºåœ°å€ã€ç”¨æˆ·åç­‰     |
| `password` | å¯†ç è¾“å…¥æ¡† | å¯†ç ã€å¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯    |
| `number`   | æ•°å­—è¾“å…¥æ¡† | ç«¯å£ã€è¶…æ—¶æ—¶é—´ç­‰      |
| `select`   | ä¸‹æ‹‰é€‰æ‹©æ¡† | åœ°åŸŸã€åè®®ç±»å‹ç­‰      |
| `switch`   | å¼€å…³ç»„ä»¶  | å¯ç”¨/ç¦ç”¨é€‰é¡¹       |
| `textarea` | å¤šè¡Œæ–‡æœ¬æ¡† | JSONé…ç½®ã€è‡ªå®šä¹‰å¤´éƒ¨ç­‰ |

## ğŸŒ äº‘å¹³å°é…ç½®è¯¦è§£

### 1. **é˜¿é‡Œäº‘IoTå¹³å°**

| å­—æ®µ                | ç±»å‹       | å¿…å¡« | è¯´æ˜                            |
|-------------------|----------|----|-------------------------------|
| `regionId`        | select   | âœ…  | åœ°åŸŸIDï¼ˆcn-shanghaiã€cn-beijingç­‰ï¼‰ |
| `accessKeyId`     | input    | âœ…  | AccessKey ID                  |
| `accessKeySecret` | password | âœ…  | AccessKey Secret              |
| `instanceId`      | input    | âœ…  | IoTå®ä¾‹ID                       |

### 2. **è…¾è®¯äº‘IoTå¹³å°**

| å­—æ®µ           | ç±»å‹       | å¿…å¡« | è¯´æ˜                            |
|--------------|----------|----|-------------------------------|
| `region`     | select   | âœ…  | åœ°åŸŸï¼ˆap-guangzhouã€ap-shanghaiç­‰ï¼‰ |
| `secretId`   | input    | âœ…  | Secret ID                     |
| `secretKey`  | password | âœ…  | Secret Key                    |
| `productId`  | input    | âŒ  | äº§å“IDï¼ˆå¯é€‰ï¼‰                      |
| `deviceName` | input    | âŒ  | è®¾å¤‡åç§°ï¼ˆå¯é€‰ï¼‰                      |

### 3. **åä¸ºäº‘IoTå¹³å°**

| å­—æ®µ          | ç±»å‹       | å¿…å¡« | è¯´æ˜                         |
|-------------|----------|----|----------------------------|
| `region`    | select   | âœ…  | åœ°åŸŸï¼ˆcn-north-4ã€cn-south-1ç­‰ï¼‰ |
| `projectId` | input    | âœ…  | é¡¹ç›®ID                       |
| `appId`     | input    | âœ…  | åº”ç”¨ID                       |
| `appSecret` | password | âœ…  | åº”ç”¨å¯†é’¥                       |
| `appName`   | input    | âŒ  | åº”ç”¨åç§°ï¼ˆå¯é€‰ï¼‰                   |

## ğŸ”Œ èµ„æºç±»å‹é…ç½®è¯¦è§£

### 1. **MySQLæ•°æ®åº“**

| å­—æ®µ                  | ç±»å‹       | å¿…å¡« | é»˜è®¤å€¼     | è¯´æ˜       |
|---------------------|----------|----|---------|----------|
| `host`              | input    | âœ…  | -       | ä¸»æœºåœ°å€     |
| `port`              | number   | âœ…  | 3306    | ç«¯å£å·      |
| `username`          | input    | âœ…  | -       | ç”¨æˆ·å      |
| `password`          | password | âœ…  | -       | å¯†ç        |
| `databaseName`      | input    | âœ…  | -       | æ•°æ®åº“å     |
| `charset`           | select   | âŒ  | utf8mb4 | å­—ç¬¦é›†      |
| `connectionTimeout` | number   | âŒ  | 30000   | è¿æ¥è¶…æ—¶(ms) |
| `maxConnections`    | number   | âŒ  | 10      | æœ€å¤§è¿æ¥æ•°    |
| `tablePrefix`       | input    | âŒ  | -       | è¡¨åå‰ç¼€     |
| `batchSize`         | number   | âŒ  | 1000    | æ‰¹é‡å¤§å°     |

### 2. **Kafkaæ¶ˆæ¯é˜Ÿåˆ—**

| å­—æ®µ                  | ç±»å‹     | å¿…å¡« | é»˜è®¤å€¼            | è¯´æ˜     |
|---------------------|--------|----|----------------|--------|
| `host`              | input  | âœ…  | -              | ä¸»æœºåœ°å€   |
| `port`              | number | âœ…  | 9092           | ç«¯å£å·    |
| `topic`             | input  | âœ…  | -              | ä¸»é¢˜åç§°   |
| `securityProtocol`  | select | âŒ  | PLAINTEXT      | å®‰å…¨åè®®   |
| `saslMechanism`     | select | âŒ  | -              | SASLæœºåˆ¶ |
| `groupId`           | input  | âŒ  | -              | æ¶ˆè´¹è€…ç»„ID |
| `partitions`        | number | âŒ  | 1              | åˆ†åŒºæ•°    |
| `replicationFactor` | number | âŒ  | 1              | å‰¯æœ¬æ•°    |
| `serializer`        | select | âŒ  | JsonSerializer | åºåˆ—åŒ–å™¨   |
| `compressionType`   | select | âŒ  | none           | å‹ç¼©ç±»å‹   |

### 3. **MQTTæ¶ˆæ¯ä»£ç†**

| å­—æ®µ               | ç±»å‹       | å¿…å¡« | é»˜è®¤å€¼  | è¯´æ˜      |
|------------------|----------|----|------|---------|
| `host`           | input    | âœ…  | -    | ä¸»æœºåœ°å€    |
| `port`           | number   | âœ…  | 1883 | ç«¯å£å·     |
| `username`       | input    | âŒ  | -    | ç”¨æˆ·å     |
| `password`       | password | âŒ  | -    | å¯†ç       |
| `clientId`       | input    | âŒ  | -    | å®¢æˆ·ç«¯ID   |
| `qos`            | select   | âŒ  | 1    | QoSç­‰çº§   |
| `keepAlive`      | number   | âŒ  | 60   | ä¿æŒè¿æ¥(s) |
| `cleanSession`   | switch   | âŒ  | true | æ¸…é™¤ä¼šè¯    |
| `subscribeTopic` | input    | âŒ  | -    | è®¢é˜…ä¸»é¢˜    |
| `publishTopic`   | input    | âŒ  | -    | å‘å¸ƒä¸»é¢˜    |

### 4. **Redisç¼“å­˜**

| å­—æ®µ                  | ç±»å‹       | å¿…å¡« | é»˜è®¤å€¼  | è¯´æ˜       |
|---------------------|----------|----|------|----------|
| `host`              | input    | âœ…  | -    | ä¸»æœºåœ°å€     |
| `port`              | number   | âœ…  | 6379 | ç«¯å£å·      |
| `password`          | password | âŒ  | -    | å¯†ç        |
| `database`          | number   | âŒ  | 0    | æ•°æ®åº“ç´¢å¼•    |
| `connectionTimeout` | number   | âŒ  | 5000 | è¿æ¥è¶…æ—¶(ms) |
| `readTimeout`       | number   | âŒ  | 3000 | è¯»å–è¶…æ—¶(ms) |
| `maxConnections`    | number   | âŒ  | 8    | æœ€å¤§è¿æ¥æ•°    |
| `keyPrefix`         | input    | âŒ  | -    | é”®å‰ç¼€      |

### 5. **HTTPæ¥å£**

| å­—æ®µ              | ç±»å‹       | å¿…å¡« | é»˜è®¤å€¼              | è¯´æ˜       |
|-----------------|----------|----|------------------|----------|
| `baseUrl`       | input    | âœ…  | -                | åŸºç¡€URL    |
| `method`        | select   | âœ…  | POST             | è¯·æ±‚æ–¹æ³•     |
| `contentType`   | select   | âœ…  | application/json | å†…å®¹ç±»å‹     |
| `authType`      | select   | âŒ  | none             | è®¤è¯ç±»å‹     |
| `authToken`     | password | âŒ  | -                | è®¤è¯ä»¤ç‰Œ     |
| `timeout`       | number   | âŒ  | 30000            | è¶…æ—¶æ—¶é—´(ms) |
| `retryTimes`    | number   | âŒ  | 3                | é‡è¯•æ¬¡æ•°     |
| `customHeaders` | textarea | âŒ  | -                | è‡ªå®šä¹‰å¤´éƒ¨    |

## ğŸ“Š çŠ¶æ€å’Œç±»å‹å®šä¹‰

### 1. **æ•°æ®æµå‘ (databridge_direction)**

| å€¼      | æ ‡ç­¾   | è¯´æ˜             |
|--------|------|----------------|
| `OUT`  | æ•°æ®è¾“å‡º | IoTå¹³å°æ•°æ®è¾“å‡ºåˆ°å¤–éƒ¨ç³»ç»Ÿ |
| `IN`   | æ•°æ®è¾“å…¥ | å¤–éƒ¨ç³»ç»Ÿæ•°æ®è¾“å…¥åˆ°IoTå¹³å° |
| `BOTH` | åŒå‘æµè½¬ | æ”¯æŒåŒå‘æ•°æ®æµè½¬       |

### 2. **æ¡¥æ¥çŠ¶æ€ (databridge_status)**

| å€¼   | æ ‡ç­¾  | è¯´æ˜      |
|-----|-----|---------|
| `0` | å·²åœç”¨ | æ¡¥æ¥é…ç½®å·²åœç”¨ |
| `1` | å·²å¯ç”¨ | æ¡¥æ¥é…ç½®å·²å¯ç”¨ |
| `2` | è¿è¡Œä¸­ | æ¡¥æ¥ä»»åŠ¡è¿è¡Œä¸­ |
| `3` | å·²æš‚åœ | æ¡¥æ¥ä»»åŠ¡å·²æš‚åœ |
| `4` | é”™è¯¯  | æ¡¥æ¥ä»»åŠ¡å‡ºé”™  |

### 3. **æ¶ˆæ¯ç±»å‹ (databridge_message_type)**

| å€¼                | æ ‡ç­¾   | è¯´æ˜       |
|------------------|------|----------|
| `PROPERTIES`     | å±æ€§ä¸ŠæŠ¥ | è®¾å¤‡å±æ€§æ•°æ®ä¸ŠæŠ¥ |
| `EVENT`          | äº‹ä»¶ä¸ŠæŠ¥ | è®¾å¤‡äº‹ä»¶æ•°æ®ä¸ŠæŠ¥ |
| `FUNCTIONS`      | åŠŸèƒ½è°ƒç”¨ | è®¾å¤‡åŠŸèƒ½è°ƒç”¨   |
| `DEVICE_ONLINE`  | è®¾å¤‡ä¸Šçº¿ | è®¾å¤‡ä¸Šçº¿æ¶ˆæ¯   |
| `DEVICE_OFFLINE` | è®¾å¤‡ç¦»çº¿ | è®¾å¤‡ç¦»çº¿æ¶ˆæ¯   |

## ğŸš€ ä½¿ç”¨æ–¹å¼

### 1. **å‰ç«¯åŠ¨æ€è¡¨å•ç”Ÿæˆ**

å‰ç«¯å¯ä»¥æ ¹æ®å­—å…¸é…ç½®åŠ¨æ€ç”Ÿæˆè¡¨å•ï¼š

```javascript
// è·å–èµ„æºç±»å‹çš„é…ç½®å­—æ®µ
const getResourceFields = async (resourceType) => {
  const dictType = `databridge_${resourceType.toLowerCase()}_fields`
  const response = await getDictData(dictType)
  
  return response.data.map(item => ({
    field: item.dict_value,
    label: item.dict_label,
    config: JSON.parse(item.remark)
  }))
}
```

### 2. **åç«¯é…ç½®éªŒè¯**

åç«¯å¯ä»¥æ ¹æ®å­—å…¸é…ç½®éªŒè¯è¡¨å•æ•°æ®ï¼š

```java
// éªŒè¯èµ„æºè¿æ¥é…ç½®
public boolean validateResourceConfig(ResourceConnection connection) {
    String dictType = "databridge_" + connection.getType().name().toLowerCase() + "_fields";
    List<SysDictData> fields = dictService.selectDictDataByType(dictType);
    
    for (SysDictData field : fields) {
        FieldConfig config = JSON.parseObject(field.getRemark(), FieldConfig.class);
        if (config.isRequired()) {
            // éªŒè¯å¿…å¡«å­—æ®µ
            validateRequiredField(connection, field.getDictValue());
        }
    }
    
    return true;
}
```

## ğŸ“ æ‰©å±•è¯´æ˜

### 1. **æ·»åŠ æ–°çš„èµ„æºç±»å‹**

1. åœ¨ `databridge_resource_type` ä¸­æ·»åŠ æ–°çš„èµ„æºç±»å‹
2. åˆ›å»ºå¯¹åº”çš„é…ç½®å­—æ®µå­—å…¸ç±»å‹ï¼ˆå¦‚ `databridge_xxx_fields`ï¼‰
3. å®šä¹‰è¯¥èµ„æºç±»å‹çš„æ‰€æœ‰é…ç½®å­—æ®µ
4. æ›´æ–°åç«¯æšä¸¾å’Œå‰ç«¯ç»„ä»¶

### 2. **æ·»åŠ æ–°çš„äº‘å¹³å°**

1. åœ¨ `databridge_cloud_platform` ä¸­æ·»åŠ æ–°çš„äº‘å¹³å°
2. åˆ›å»ºå¯¹åº”çš„é…ç½®å­—æ®µå­—å…¸ç±»å‹
3. å®šä¹‰äº‘å¹³å°ç‰¹æœ‰çš„è®¤è¯å’Œé…ç½®å­—æ®µ
4. å®ç°å¯¹åº”çš„æ’ä»¶ç±»

### 3. **å­—æ®µé…ç½®æ‰©å±•**

å­—æ®µé…ç½®JSONå¯ä»¥æ‰©å±•æ›´å¤šå±æ€§ï¼š

```json
{
  "type": "input",
  "required": true,
  "placeholder": "è¯·è¾“å…¥...",
  "default": "é»˜è®¤å€¼",
  "validation": {
    "pattern": "æ­£åˆ™è¡¨è¾¾å¼",
    "message": "éªŒè¯å¤±è´¥æ¶ˆæ¯"
  },
  "dependency": {
    "field": "ä¾èµ–å­—æ®µ",
    "value": "ä¾èµ–å€¼"
  }
}
```

è¿™æ ·çš„è®¾è®¡ä½¿å¾—æ•´ä¸ªæ•°æ®æ¡¥æ¥ç³»ç»Ÿå…·æœ‰å¾ˆå¥½çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚
