<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¸…é™¤ç‰ˆæœ¬ç¼“å­˜å·¥å…·</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }

    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    h1 {
      color: #1890ff;
      margin-top: 0;
    }

    button {
      background: #1890ff;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px 10px 0;
    }

    button:hover {
      background: #40a9ff;
    }

    .info {
      background: #e6f7ff;
      border: 1px solid #91d5ff;
      padding: 12px;
      border-radius: 4px;
      margin: 15px 0;
    }

    .success {
      background: #f6ffed;
      border: 1px solid #b7eb8f;
      color: #52c41a;
    }

    pre {
      background: #f5f5f5;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>ğŸš€ ç‰ˆæœ¬ç¼“å­˜æ¸…é™¤å·¥å…·</h1>

  <div class="info">
    <strong>è¯´æ˜ï¼š</strong><br>
    å¦‚æœç‰ˆæœ¬æ›´æ–°å¼¹çª—æ²¡æœ‰æ­£ç¡®æ˜¾ç¤ºï¼Œä½¿ç”¨æ­¤å·¥å…·æ¸…é™¤ç¼“å­˜ååˆ·æ–°é¡µé¢ã€‚
  </div>

  <h3>å½“å‰ç¼“å­˜çŠ¶æ€ï¼š</h3>
  <div id="status"></div>

  <h3>æ“ä½œï¼š</h3>
  <button onclick="clearVersionCache()">æ¸…é™¤ç‰ˆæœ¬ç¼“å­˜</button>
  <button onclick="clearReadVersions()">æ¸…é™¤å·²è¯»æ ‡è®°</button>
  <button onclick="clearAll()">æ¸…é™¤æ‰€æœ‰</button>
  <button onclick="checkStatus()">åˆ·æ–°çŠ¶æ€</button>

  <div id="result"></div>
</div>

<script>
  function checkStatus() {
    const versionInfo = localStorage.getItem('version_info');
    const lastReadVersion = localStorage.getItem('last_read_version');
    // å¯¹æ—§ç‰ˆæœ¬å…¼å®¹
    const readVersions = localStorage.getItem('read_versions');

    let html = '<pre style="text-align: left;">';
    html += '=== LocalStorage ç‰ˆæœ¬ç¼“å­˜çŠ¶æ€ ===\n\n';

    html += '1. version_info: ' + (versionInfo ? '\u2705 å­˜åœ¨' : '\u274c ä¸å­˜åœ¨') + '\n';
    if (versionInfo) {
      try {
        const info = JSON.parse(versionInfo);
        html += '   - å½“å‰ç‰ˆæœ¬: ' + info.currentVersion + '\n';
        html += '   - ç‰ˆæœ¬æ•°é‡: ' + (info.versions ? info.versions.length : 0) + '\n';
        html += '   - ç¼“å­˜æ—¶é—´: ' + (info.lastCheckTime ? new Date(
          info.lastCheckTime).toLocaleString() : 'æœªçŸ¥') + '\n';
        if (info.versions && info.versions.length > 0) {
          html += '   - æœ€æ–°ç‰ˆæœ¬: ' + info.versions[0].version + '\n';
          html += '   - ç‰ˆæœ¬åˆ—è¡¨: ' + info.versions.map(v => v.version).join(', ') + '\n';
        }
      } catch (e) {
        html += '   - \u26a0\ufe0f è§£æé”™è¯¯: ' + e.message + '\n';
      }
    }

    html += '\n2. last_read_version (æ–°): ' + (lastReadVersion ? '\u2705 ' + lastReadVersion
      : '\u274c ä¸å­˜åœ¨') + '\n';

    if (readVersions) {
      html += '\n3. read_versions (æ—§): ' + '\u26a0\ufe0f æ£€æµ‹åˆ°æ—§ç‰ˆæœ¬æ•°æ®\n';
      try {
        const reads = JSON.parse(readVersions);
        html += '   - å·²è¯»ç‰ˆæœ¬: ' + (reads.length > 0 ? reads.join(', ') : 'æ— ') + '\n';
        html += '   - \u5efaè®®: ç‚¹å‡»"æ¸…é™¤æ‰€æœ‰"å‡çº§åˆ°æ–°ç‰ˆæœ¬\n';
      } catch (e) {
        html += '   - \u26a0\ufe0f è§£æé”™è¯¯: ' + e.message + '\n';
      }
    }

    html += '\n=== å½“å‰ version.json é…ç½® ===\n';
    html += 'è¯·æŸ¥çœ‹ /src/config/version.json æ–‡ä»¶\n';
    html += '- currentVersion: 2.0.0\n';
    html += '- checkInterval: 300000 (5åˆ†é’Ÿ)\n';
    html += '- å­˜å‚¨æ ¼å¼: å•ä¸€ç‰ˆæœ¬å· (last_read_version)\n';
    html += '</pre>';

    document.getElementById('status').innerHTML = html;
  }

  function clearVersionCache() {
    localStorage.removeItem('version_info');
    showResult('ç‰ˆæœ¬ç¼“å­˜å·²æ¸…é™¤ï¼', 'success');
    checkStatus();
  }

  function clearReadVersions() {
    // æ¸…é™¤æ–°ç‰ˆæœ¬
    localStorage.removeItem('last_read_version');
    // æ¸…é™¤æ—§ç‰ˆæœ¬ï¼ˆå…¼å®¹ï¼‰
    localStorage.removeItem('read_versions');
    showResult('å·²è¯»æ ‡è®°å·²æ¸…é™¤ï¼ä¸‹æ¬¡åˆ·æ–°é¡µé¢å°†é‡æ–°æ˜¾ç¤ºç‰ˆæœ¬å¼¹çª—ã€‚', 'success');
    checkStatus();
  }

  function clearAll() {
    localStorage.removeItem('version_info');
    localStorage.removeItem('last_read_version');
    localStorage.removeItem('read_versions');  // å…¼å®¹æ—§ç‰ˆæœ¬
    showResult('æ‰€æœ‰ç‰ˆæœ¬ç›¸å…³ç¼“å­˜å·²æ¸…é™¤ï¼ç°åœ¨å¯ä»¥åˆ·æ–°é¡µé¢æŸ¥çœ‹æœ€æ–°ç‰ˆæœ¬å¼¹çª—ã€‚', 'success');
    checkStatus();
  }

  function showResult(message, type) {
    const resultDiv = document.getElementById('result');
    resultDiv.className = 'info ' + type;
    resultDiv.innerHTML = '<strong>' + message + '</strong>';
    setTimeout(() => {
      resultDiv.innerHTML = '';
      resultDiv.className = '';
    }, 3000);
  }

  // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥çŠ¶æ€
  checkStatus();
</script>
</body>
</html>
